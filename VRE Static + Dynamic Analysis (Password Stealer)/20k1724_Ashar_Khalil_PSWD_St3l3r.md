## Malware: Password Stealer
## Ashar Khalil (20k1724) 

[Static Analysis  2 ](#_page1_x69.00_y189.00)

[Dynamic Analysis (Any.run) ](#_page15_x69.00_y72.00)

[IDA Debugging 23 ](#_page22_x69.00_y72.00)

**Context. ![](imgs/image%2001.jpg)**

Spyware.PasswordStealer is Malwarebytes' generic detection name for applications that may run in the background and silently collect information about the system, connected users, and network activity. It attempts to steal stored credentials, usernames, passwords, and other personal and confidential information This spyware may allow an attacker to install additional software to the infected machine or may direct the infected machine to participate in a malicious botnet for the purposes of sending spam or other malicious activities. 

<a name="_page1_x69.00_y189.00"></a>Static Analysis 

1. **Magic byte** 

![](imgs/image%202.jpg)

2. **File signature** 

**MZ + PE32 +INTEL 386** 

![](imgs/image%203.jpg)

3. **Machine information** 

![](imgs/image%204.jpg)

4. **Exe type (32/64 bit)** 

![](imgs/image%205.jpg)

H**ASHES** ![](imgs/image%201.jpg)

![](imgs/image%206.jpg)

**YARA rule**  

![](imgs/image%207.jpg)

Number, type and offset of different sections of Malware. 

![](imgs/image%208.jpg)

5\.DLLs and their number of functions used by Malware? 
![](imgs/image%2010.jpg)

6\. What is packing information if Malware is packed? 

![](imgs/image%2011.jpg)

VirusTotal: [(https://www.virustotal.com/gui/home/upload)](https://www.virustotal.com/gui/home/upload) ![](imgs/image%2001.jpg)

![](imgs/image%2012.jpg)

**ENTRY POINT:** 

![](imgs/image%2013.jpg)

Let’s check Entry Point on debugger. 

![](imgs/image%2014.jpg)

![](imgs/image%2015.jpg)

Imports: ![](imgs/image%2001.jpg)

![](imgs/image%2016jpg)

**PE Studio:** IOCs by PE 

Imports in PE Studio. ![](imgs/image%2001.jpg)![](imgs/image%2017jpg)![](imgs/image%2018jpg)

Entropy of different sections suggests that malware is not encrypted. ![](imgs/image%2001.jpg)![](imgs/image%2019jpg)![](imgs/image%2020jpg)

**IDA static Analysis: ![](imgs/image%2001.jpg)**

![](imgs/image%2021.jpg)

As it is a password stealer by the name, so I searched for password, got ingesting things, many of the behaviors are clear even from the string analysis. 

![](imgs/image%2022.jpg)

Strings like FTP password make it clear that it targets all types of passwords in a machine. 

Let’s investigate a function by clicking on a password string. 
![](imgs/image%2001.jpg)

![](imgs/image%2023.jpg)

As it targets a lot of files, it seems that it downloads an additional software Flash Peak for FTP password’s stealing. 

It is evident from there. 

![](imgs/image%2024.jpg)

Stealing isn’t limited to PC only it accesses all types of browsers also. As the creds dumping from browsers is very easy. 

![](imgs/image%2025.jpg)

It also targets the outlook files. ![](imgs/image%2001.jpg)

![](imgs/image%2026.jpg)

**Type Libraries** 

![](imgs/image%2027.jpg)

Import directory is same as it was in CFF and Pe studio. 

![](imgs/image%2028.jpg)

As we can see different sockets imports we can make a assumption that this malware makes connection and sends our passwords as we can see the send , receives, gethostbyname functionalities in import functions. 
![](imgs/image%2001.jpg)

![](imgs/image%2029.jpg)

We can use this tab to hover and locate our functions. 

Let’s see a random function ad do a static analysis of it. 
![](imgs/image%2001.jpg)
![](imgs/image%2030.jpg)

![](imgs/image%2031.jpg)

We can also examine the structure in detail. 
![](imgs/image%2001.jpg)

![](imgs/image%2032.jpg)

We can see that this function is somehow connected with FileZilla application. 

Let’s see another functions graph. 

This graph suggests that this function is using some mechanism get credentials, 

![](imgs/image%2033.jpg)

<a name="_page15_x69.00_y72.00"></a>Dynamic Analysis (Any.run) 
![](imgs/image%2001.jpg)

IOC’s:

![](imgs/image%2034.jpg)

We also seen this domain in static analysis, it seems that this domain has some connection to malware in aspect of downloading or something other. We will examine this domain relation later. 

Any run also made observations of credentials stealing. 

![](imgs/image%2035.jpg)

Butter Choco is requested but it is not live so it won’t be making any uploads. This is an old malware and currently inactive. 

![](imgs/image%2036.jpg)

Overview in any run. 
![](imgs/image%2001.jpg)![](imgs/image%2037.jpg)

If we specifically check on the behavior. 
![](imgs/image%2001.jpg)
![](imgs/image%2038.jpg)

We can see that this method has access to read the file. Anyrun maps the malware activities on Mitre ATTACK matrix. 

![](imgs/image%2039.jpg)

It loads these files when it is run. ![](imgs/image%2001.jpg)

![](imgs/image%2040.jpg)

And do the following registry changes. 

![](imgs/image%2041.jpg)

FLOW: 

![](imgs/image%2042.jpg)

![](imgs/image%2043.jpg)

![](imgs/image%2044.jpg)

So far, we observed these things by dynamic analysis. ![](imgs/image%2001.jpg)![](imgs/image%2045.jpg)![](imgs/image%2046.jpg)

<a name="_page22_x69.00_y72.00"></a>IDA Debugging ![](imgs/image%2001.jpg)

The entry point is in the middle of the file, which indicates it is malware. 

![](imgs/image%2047.jpg)

![](imgs/image%2048.jpg)

` `IsWow64Process , which is used by malware to identify **if it's running as a 32-bit process in an x64 environment**... 

![](imgs/image%2049.jpg)

"The main product available here is the aPLib compression library, which I started working on back in 1997 as a part of my executable compressor aPACK. Since its first public release in 1998 it has ranked as one of the best pure LZ-based compression libraries available. 

![](imgs/image%2050.jpg)

exe called "GetLocaleInfoA"  
![](imgs/image%2001.jpg)

kernel function GetTickCount is used to check the duration of time the system is on. Overall graph 

![](imgs/image%2051.jpg)
